<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hardening the Moto One Macro</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel=stylesheet href="https://blog.ayham.xyz/css/common.css" /><link rel=stylesheet href="https://blog.ayham.xyz/css/header.css" /><link rel="shortcut icon" href="https://ayham.xyz/pix/pfp.ico">
<meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />
<meta name="Ayham's Online Website">
</head>
<body>
<div id="preamble" class="status">
<nav>
	<ul class=header>
		<a class="viewer" href="https://ayham.xyz"><li>
			üè† Home</li>
		</a>
		<a href="https://store.ayham.xyz"><li>
			üè™ Store</li>
		</a>
		<a href="https://tildegit.org/ayham"><li>
			<img src="https://ayham.xyz/pix/git.svg" alt="git logo">
			Git</li>
		</a>
		<a href="https://ayham.xyz/projects.html"><li>
			‚öôÔ∏è Projects</li>
		</a>
		<a href="https://ayham.xyz/blog/index.html"><li>
			üìú Articles</li>
		</a>
		<a href="https://ayham.xyz/workflow.html"><li>
			üíª Workflow</li>
		</a>
		<a href="https://ayham.xyz/library.html"><li>
			üìö Library</li>
		</a>
		<a href="https://ayham.xyz/contact.html"><li>
			üìß Contact</li>
		</a>
	</ul>
</nav>
<br>
</div>
<div id="content" class="content">
<h1 class="title">Hardening the Moto One Macro</h1>

<div id="outline-container-org6252a11" class="outline-2">
<h2 id="org6252a11">The Moto One Macro</h2>
<div class="outline-text-2" id="text-org6252a11">
<p>
The Motorola One Macro is a mid-range phone, with decent "openness" which allows
basic hardening modification. The phone has the follow specifications:
</p>

<ul class="org-ul">
<li>Mediatek MT6771 Helio P70 CPU</li>
<li>720 x 1520 px, 19:9 ratios (~270 ppi)</li>
<li>Comes with Anroid 9.0, officially upgradable to Android 10.0</li>
<li>Mali-G72 MP3 GPU</li>
<li>eMMC 5.1 storage with 64GB</li>
<li>microSDXC uses shared SIM slot, 32GB tested</li>
<li>Main camera 13 MP, depth camera 2MP, 2MP for macro camera</li>
<li>WIFI 802.11 b/g/n, with hot-spot</li>
<li>No NFC support</li>
</ul>

<p>
This guide goes over unlocking the bootloader, flashing a GSI, flashing
LineageOS, reflashing stock ROM, fixing bootloop problems, and news
on TWRP for the Moto One Macro.
</p>
</div>
</div>

<div id="outline-container-org647b640" class="outline-2">
<h2 id="org647b640">Moto's Naming Schemes</h2>
<div class="outline-text-2" id="text-org647b640">
<p>
Motorola has a weird naming scheme, but the following is a fair summary. XT2016
is the model name. XT2016-1 and XT2016-2 are two different models. To check for
your own variant, go to <b>Settings -&gt; About phone -&gt; Model &amp; hardware</b>. PMD named
ROMs are older than QMD named ROMs. QMD30, 30 is the release version. Lima is
the nickname for Moto One Macro. Software channel, from my understanding, is
related to the source of system updates. I had trouble updating after flashing
Android 10 directly, but flashing stock Android 9.0 solved the issue. I haven't
tested it thoroughly though. Updating from stock Android 9.0 to Android 10 is
easily done from the settings.
</p>
</div>
</div>

<div id="outline-container-orge3585b5" class="outline-2">
<h2 id="orge3585b5">Unlocking the Bootloader</h2>
<div class="outline-text-2" id="text-orge3585b5">
<p>
Go to <a href="https://motorola-global-portal.custhelp.com/app/standalone/bootloader/unlock-your-device-a/">Motorola's official website</a>, click next, create an account, plug your
phone into your computer and run:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ fastboot oem get_unlock_data
</pre>
</div>

<p>
This command will return five lines of data, concatenate the data returned after
<b>(bootloader)</b>. Paste this string into the textbox on the site. You will be
e-mailed with your unlocking code.
</p>

<p>
Finally, to unlock the phone:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ fastboot oem unlock [e-mailed code]
$ <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">run the previous command twice</span>
</pre>
</div>

<p>
<b>Note: This formats ALL user-data and voids any warranty</b>
</p>
</div>
</div>

<div id="outline-container-orgf68afe2" class="outline-2">
<h2 id="orgf68afe2">Flashing Stock</h2>
<div class="outline-text-2" id="text-orgf68afe2">
<p>
Stock ROMs can be useful to reset and try any new updates Motorola bestows upon
its users, or to use Google-based Apps. Usually, these ROMs are infested with
<b>Motorola &amp; Metaverse</b> software.
</p>

<p>
To get the stock ROM, navigate to <a href="https://motostockrom.com">motostockrom.com</a>, search for XT2016, select
the correct model varient and choose your stock ROM to download.
</p>

<p>
Unzip the file, <b>chmod</b> the <b>flashfile.bat</b> after examining the file. Plug your
phone, and run the following commands:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ unzip $(moto_stock_rom_file).zip
$ cd $(moto_stock_rom_file)/Firmware/
$ vi flashfile.bat <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">examine the file, make sure it isn't doing something fishy</span>
$ chmod +x flashfile.bat
$ ./flashfile.bat
</pre>
</div>

<p>
<b>Note: This formats ALL user-data and voids any warranty</b>
</p>
</div>
</div>

<div id="outline-container-orgbe512f8" class="outline-2">
<h2 id="orgbe512f8">Flashing GSI</h2>
<div class="outline-text-2" id="text-orgbe512f8">
<p>
GSIs are generic images, where the Android system is updated separate from
proprietary vendor drivers. GSI can be AOSP, Google plagued, or LineageOS. This
section talks about the <a href="https://github.com/phhusson/treble_experimentations">treble GSIs</a>. The only treble GSI ROM I have tested is
<a href="https://github.com/phhusson/treble_experimentations/releases/tag/v220">AOSP 10.0 v220</a>. Always choose arm64 A/B ROMs.
</p>

<p>
Download Google's <a href="https://dl.google.com/developers/android/qt/images/gsi/vbmeta.img">vbmeta</a>. After downloading the variant you want to flash, run
the following commands:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ unxz $(system_iso).xz
$ fastboot --disable-verity --disable-verification flash vbmeta_a vbmeta.img
$ fastboot --disable-verity --disable-verification flash vbmeta_b vbmeta.img
$ fastboot flash system_a $(system_iso)
$ fastboot flash system_b $(system_iso)
$ fastboot erase userdata
</pre>
</div>

<p>
<b>Note: This formats ALL user-data and voids any warranty</b>
</p>
</div>
</div>

<div id="outline-container-org724a8fe" class="outline-2">
<h2 id="org724a8fe">Flashing LineageOS</h2>
<div class="outline-text-2" id="text-org724a8fe">
<p>
LineageOS being a customizable custom android ROM, is wanted by many.
Unfortunately, one can only support as many Android devices until it is no
longer feasable. GSIs try to deliver a user experience that attempts to solve
this. LineageOS GSI ROMs tend to be very buggy, mainly because of issues with
vendor bootloaders. LineageOS GSI is flashable to the One Macro, and does indeed
work. Wi-Fi, SMS and Calls do work. I have not tested Bluetooth. The image we
are going to flash is not official nor affiliated with LineageOS developers
themselves.
</p>

<p>
Download Google's <a href="https://dl.google.com/developers/android/qt/images/gsi/vbmeta.img">vbmeta</a>. Navigate to <a href="https://sourceforge.net/projects/andyyan-gsi/files/">Andy Yan's files</a>. I have tested
LineageOS 17. Pick the image with arm64 <b>and</b> A/B systems. Then run the
following commands:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ unxz $(system_iso).xz
$ fastboot --disable-verity --disable-verification flash vbmeta_a vbmeta.img
$ fastboot --disable-verity --disable-verification flash vbmeta_b vbmeta.img
$ fastboot flash system_a $(system_iso)
$ fastboot flash system_b $(system_iso)
$ fastboot erase userdata
</pre>
</div>

<p>
<b>Note: This formats ALL user-data and voids any warranty</b>
</p>
</div>
</div>

<div id="outline-container-org77948c3" class="outline-2">
<h2 id="org77948c3">Magisk</h2>
<div class="outline-text-2" id="text-org77948c3">
<p>
Generally, following <a href="https://topjohnwu.github.io/Magisk/install.html">Magisk's official</a> installation guide works out of the box.
Note however after flashing phh's treble GSIs, first Securize ROM by un-rooting
the device. <b>Settings -&gt; Phh Settings -&gt; Securize</b>
</p>
</div>
</div>

<div id="outline-container-orge034cd3" class="outline-2">
<h2 id="orge034cd3">Common Problems</h2>
<div class="outline-text-2" id="text-orge034cd3">
<p>
I have intentionally left out problems to this section due to its
repetitiveness. This section includes solutions that are wacky but worked for
me. Suprisingly, this phone <b>never</b> permanently soft-bricked.
</p>
</div>

<div id="outline-container-org32a67b0" class="outline-3">
<h3 id="org32a67b0">Corrupted dm-verity</h3>
<div class="outline-text-3" id="text-org32a67b0">
<p>
After flashing multiple times with different ROMs, you might receive a dm-verity
&amp; memory is corrupt error or something similar. You might have also tried
formatting <b>user-data</b> and flashing <b>vbmeta</b> as done before. This issue happened
to me after I tried to downgrade to Android 10 stock ROM. Resolving this issue
is as easy as relocking and unlocking the boot-loader.
</p>

<div class="org-src-container">
<pre class="src src-bash">$ fastboot oem lock
$ <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">run the previous command twice</span>
</pre>
</div>

<p>
<b>Note: This formats ALL user-data and voids any warranty</b>
</p>
</div>
</div>

<div id="outline-container-orgf797f01" class="outline-3">
<h3 id="orgf797f01">Motorola Updates not Working</h3>
<div class="outline-text-3" id="text-orgf797f01">
<p>
Contrary to what Motorola said, updates can <b>still</b> be delivered OTA even after
unlocking the bootloader. I was able to upgrade from stock Android 9.0 to
Android 10. Although I haven't tested twice, downloading stock PMD29.70-81
should work with OTA updates.
</p>
</div>
</div>

<div id="outline-container-orgd6dd48a" class="outline-3">
<h3 id="orgd6dd48a">Failed to Flash Bootloader</h3>
<div class="outline-text-3" id="text-orgd6dd48a">
<p>
This section is not completely fledged out, but there are multiple methods that
could be tried when you occur an error when flashing stock boot-loader. Firstly,
try with verity off, download Google's <a href="https://dl.google.com/developers/android/qt/images/gsi/vbmeta.img">vbmeta</a>:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ fastboot --disable-verity --disable-verification flash vbmeta_a vbmeta.img
$ fastboot --disable-verity --disable-verification flash vbmeta_b vbmeta.img
$ fastboot erase userdata
</pre>
</div>

<p>
<b>Note: This formats ALL user-data and voids any warranty</b>
</p>

<p>
Secondly, you can try flashing Magisk's patched bootloader. If you would like an
un-rooted system, do not install Magisk's Manager.
</p>

<p>
Thirdly, as a last resort, try relocking and unlocking the boot-loader. Process
mentioned in "<a href="https://blog.ayham.xyz/hardening-the-one-macro.html#Corrupted%20dm-verity">Corrupted dm-verity</a>" section.
</p>
</div>
</div>
</div>

<div id="outline-container-org3d2a5fa" class="outline-2">
<h2 id="org3d2a5fa">TWRP</h2>
<div class="outline-text-2" id="text-org3d2a5fa">
<p>
<a href="https://twrp.me">TWRP</a> is an amazing bootloader. Control and customizability is a hallmark pillar
of TWRP. I personally tried working on building a TWRP recovery for the One
Macro. I got a basic working demo. Unfortunately, could not get any drivers to
work properly. This issue could be blamed on Motorola. Their drivers aren't
open-source. There might be a solution of getting blobs, although I found non.
</p>

<p>
The current Git repositories that are trying to develop a recovery:
</p>

<ul class="org-ul">
<li><a href="https://github.com/realaltffour/android_device_motorola_lima_twrp">realaltffour/android_device_motorola_lima_twrp</a> (my build)</li>
<li><a href="https://github.com/mototek/recovery_motorola_lima">mototek/recovery_motorola_lima</a></li>
</ul>

<p>
If you know any more, feel free to <a href="https://contact.ayham.xyz">send</a> me an email!
</p>
</div>
</div>

<div id="outline-container-org2f56ce8" class="outline-2">
<h2 id="org2f56ce8">Conclusion</h2>
<div class="outline-text-2" id="text-org2f56ce8">
<p>
This article was titled "Hardening the One Macro" for a reason. A first step
towards hardening your mobile phone is unlocking the bootloader. And although
this guide shows how to flash stock ROMs, these are only for pragmatic reasons.
I encourage you to flash your Moto One Macro with a treble FOSS build.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer>
  <div class="generated">
	Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2) on <a href="https://www.gnu.org">GNU</a>/<a href="https://www.kernel.org/">Linux</a>
  </div>
  <br/>
  <center id=webpins>Unique Users:
	<a href="https://www.digits.net" target="_blank" rel=noopener>
	<img src="https://counter.digits.net/?counter={f115c91c-b3dd-7584-456b-e7a9e52faa74}&template=simple" alt="Hit Counter by Digits" border=0  /></a>
	<br/>
	<br/>
	<a href="https://ayham.xyz">
	<img width=88 height=31 src="https://ayham.xyz/pix/webpins/ayhamxyz.gif" alt="ayham.xyz webpin"></a>
  </center>
</footer>
</div>
</body>
</html>
